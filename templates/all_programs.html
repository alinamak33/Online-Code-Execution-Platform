<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>All Programs</title>
  <style>
    body{font-family:Arial; max-width:1100px; margin:20px auto; padding:10px;}
    pre{background:#f3f3f3;padding:10px;border-radius:6px;overflow:auto;}
    .prog{border:1px solid #eee;padding:12px;margin-bottom:12px;border-radius:8px;}
    button{padding:6px 10px;}
  </style>
</head>
<body>
  <h1>All Programs</h1>
  <p><a href="/">Back to Run</a></p>

  {% if db %}
    {% for name, entry in db.items() %}
      <div class="prog">
        <h3>{{ name }}</h3>
        <p><b>Language:</b> {{ entry.language }} &nbsp; <b>Description:</b> {{ entry.description }}</p>
        <pre id="code-{{ loop.index }}">{{ entry.code }}</pre>
        {% if entry.language.lower().startswith('python') %}
          <label>stdin (one per line):</label>
          <textarea id="stdin-{{ loop.index }}" rows="3" style="width:100%"></textarea><br>
          <button onclick="runFromPage({{ loop.index }}, '{{ entry.language }}')">Run Python</button>
          <pre id="out-{{ loop.index }}"></pre>
        {% endif %}
      </div>
    {% endfor %}
  {% else %}
    <p>No programs in database.</p>
  {% endif %}

<script>
async function runFromPage(idx, lang) {
  const code = document.getElementById('code-' + idx).textContent;
  const stdin = document.getElementById('stdin-' + idx).value || "";
  const outEl = document.getElementById('out-' + idx);
  outEl.textContent = "Running...";
  const resp = await fetch('/run', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({code, language: lang, versionIndex: '3', stdin})
  });
  const j = await resp.json();
  outEl.textContent = j.ok ? (j.result || JSON.stringify(j.meta,null,2)) : ("Error: " + j.error);
}
</script>
</body>
</html>
